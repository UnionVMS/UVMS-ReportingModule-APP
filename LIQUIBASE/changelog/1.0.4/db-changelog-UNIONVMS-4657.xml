<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

    <changeSet id="Tables for report generation" author="cpapatheodorou">

        <createSequence sequenceName="movement_seq" startValue="1"/>

        <createTable tableName="movement">
            <column name="id" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="position_coordinates" type="geometry(Point, 4326)">
                <constraints nullable="false"/>
            </column>
            <column name="position_time" type="timestamp"/>
            <column name="connect_id" type="varchar(36)"/>
            <column name="movement_guid" type="varchar(36)"/>
            <column name="source" type="varchar(60)"/>
            <column name="movement_type" type="varchar(60)"/>
            <column name="movement_activity_type" type="varchar(60)"/>
            <column name="reported_course" type="double"/>
            <column name="reported_speed" type="double"/>
            <column name="calculated_speed" type="double"/>
            <column name="closest_country" type="varchar(128)"/>
            <column name="closest_country_distance" type="double"/>
            <column name="closest_port" type="varchar(128)"/>
            <column name="closest_port_distance" type="double"/>


        </createTable>

        <rollback>
            <dropSequence sequenceName="movement_seq"/>
            <dropTable tableName="movement"/>
        </rollback>



        <createSequence sequenceName="segment_seq" startValue="1"/>

        <createTable tableName="segment">
            <column name="id" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="movement_guid" type="varchar(36)"/>
            <column name="segment_coordinates" type="geometry(LineString, 4326)">
                <constraints nullable="false"/>
            </column>

            <column name="track_id" type="bigint"/>
            <column name="segment_category" type="varchar(60)"/>

            <column name="calculated_speed" type="double"/>

            <column name="course_over_ground" type="double"/>
            <column name="speed_over_ground" type="double"/>
            <column name="duration" type="double"/>
            <column name="distance" type="double"/>

            <column name="asset_hist_guid" type="varchar(36)"/>
        </createTable>

        <rollback>
            <dropSequence sequenceName="segment_seq"/>
            <dropTable tableName="segment"/>
        </rollback>

        <createSequence sequenceName="track_seq" startValue="1"/>

        <createTable tableName="track">
            <column name="id" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="nearest_point_coordinates" type="varchar(255)"/>
            <column name="extent_coordinates" type="varchar(255)"/>

            <column name="duration" type="double"/>
            <column name="distance" type="double"/>
            <column name="total_time_at_sea" type="double"/>

            <column name="asset_hist_guid" type="varchar(36)"/>
        </createTable>

        <rollback>
            <dropSequence sequenceName="track_seq"/>
            <dropTable tableName="track"/>
        </rollback>

        <createSequence sequenceName="activity_seq" startValue="1"/>

        <createTable tableName="activity">
            <column name="id" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="act_id" type="varchar(30)"/>
            <column name="fa_report_id" type="varchar(36)"/>
            <column name="trip_id" type="varchar(50)"/>

            <column name="report_type" type="varchar(50)"/>
            <column name="activity_type" type="varchar(50)"/>
            <column name="purpose_code" type="varchar(50)"/>
            <column name="source" type="varchar(60)"/>
            <column name="accepted_timestamp" type="timestamp"/>
            <column name="calculated_timestamp" type="timestamp"/>
            <column name="occurrence_timestamp" type="timestamp"/>
            <column name="start_timestamp" type="timestamp"/>
            <column name="end_timestamp" type="timestamp"/>

            <column name="status" type="varchar(10)"/>
            <column name="is_latest" type="boolean" defaultValueBoolean="false"/>

            <column name="activity_coordinates" type="geometry(Multipoint, 4326)"/>
            <column name="activity_latitude" type="FLOAT8"/>
            <column name="activity_longitude" type="FLOAT8"/>

            <column name="master" type="varchar(255)"/>
            <column name="reason_code" type="varchar(255)"/>

            <column name="asset_hist_guid" type="varchar(36)"/>
        </createTable>

        <rollback>
            <dropSequence sequenceName="activity_seq"/>
            <dropTable tableName="activity"/>
        </rollback>

        <createSequence sequenceName="trip_seq" startValue="1"/>

        <createTable tableName="trip">
            <column name="id" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="trip_id" type="varchar(50)"/>
            <column name="trip_id_scheme" type="varchar(50)"/>
            <column name="trip_coordinates" type="geometry(Multipoint, 4326)"/>

            <column name="first_fishing_activity" type="varchar(50)"/>
            <column name="first_fishing_activity_timestamp" type="timestamp"/>
            <column name="last_fishing_activity" type="varchar(50)"/>
            <column name="last_fishing_activity_timestamp" type="timestamp"/>

            <column name="trip_duration" type="double"/>
            <column name="number_of_corrections" type="integer"/>
            <column name="number_of_positions" type="integer"/>

            <column name="asset_hist_guid" type="varchar(36)"/>
        </createTable>

        <rollback>
            <dropSequence sequenceName="trip_seq"/>
            <dropTable tableName="trip"/>
        </rollback>

        <createSequence sequenceName="activity_location_seq" startValue="1"/>

        <createTable tableName="activity_location">
            <column name="id" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="activity_id" type="bigint"/>
            <column name="type" type="varchar(50)"/>
            <column name="type_code" type="varchar(64)"/>
            <column name="code" type="varchar(50)"/>
            <column name="latitude" type="FLOAT8"/>
            <column name="longitude" type="FLOAT8"/>

        </createTable>

        <rollback>
            <dropSequence sequenceName="activity_location_seq"/>
            <dropTable tableName="activity_location"/>
        </rollback>

        <createSequence sequenceName="activity_catch_seq" startValue="1"/>

        <createTable tableName="activity_catch">
            <column name="id" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="activity_id" type="bigint"/>
            <column name="species_code" type="varchar(10)"/>
            <column name="gear_code" type="varchar(10)"/>
            <column name="catch_type" type="VARCHAR(50)"/>
            <column name="weight_measure" type="FLOAT8"/>
            <column name="weight_measure_unit_code" type="VARCHAR(255)"/>
            <column name="size_class" type="VARCHAR(50)"/>
            <column name="size_category" type="VARCHAR(50)"/>
            <column name="quantity" type="FLOAT8"/>
        </createTable>

        <rollback>
            <dropSequence sequenceName="activity_catch_seq"/>
            <dropTable tableName="activity_catch"/>
        </rollback>

        <createSequence sequenceName="activity_catch_processing_seq" startValue="1"/>

        <createTable tableName="activity_catch_processing">
            <column name="id" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="activity_catch_id" type="bigint"/>
            <column name="cf" type="FLOAT8"/>
            <column name="presentation" type="VARCHAR(50)"/>
            <column name="preservation" type="VARCHAR(50)"/>
            <column name="product_weight_measure" type="FLOAT8"/>
            <column name="product_weight_measure_unit_code" type="VARCHAR(255)"/>
            <column name="product_quantity" type="FLOAT8"/>
        </createTable>

        <rollback>
            <dropSequence sequenceName="activity_catch_processing_seq"/>
            <dropTable tableName="activity_catch_processing"/>
        </rollback>


        <createSequence sequenceName="activity_catch_location_seq" startValue="1"/>

        <createTable tableName="activity_catch_location">
            <column name="id" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="activity_catch_id" type="bigint"/>
            <column name="catch_location_type" type="varchar(50)"/>
            <column name="catch_location_type_code" type="varchar(64)"/>
            <column name="catch_location_code" type="varchar(50)"/>

            <column name="catch_latitude" type="FLOAT8"/>
            <column name="catch_longitude" type="FLOAT8"/>

        </createTable>

        <rollback>
            <dropSequence sequenceName="activity_catch_location_seq"/>
            <dropTable tableName="activity_catch_location"/>
        </rollback>


        <createTable tableName="activity_gear">
            <column name="activity_id" type="bigint"/>
            <column name="gear_code" type="varchar(10)"/>
        </createTable>

        <addUniqueConstraint columnNames="activity_id,gear_code" constraintName="activity_gear_unique" deferrable="true" initiallyDeferred="true" tableName="activity_gear"/>
        <rollback>
            <dropUniqueConstraint constraintName="activity_gear_unique" tableName="activity_gear"/>
            <dropTable tableName="activity_gear"/>
        </rollback>

        <createTable tableName="asset">
            <column name="asset_hist_guid" type="varchar(36)">
                <constraints nullable="false" primaryKey="true"/>
            </column>

            <column name="asset_guid" type="varchar(36)"/>

            <column name="asset_hist_active" type="boolean"/>

            <column name="uvi" type="varchar(8)"/>
            <column name="iccat" type="varchar(16)"/>
            <column name="cfr" type="varchar(12)"/>
            <column name="ircs" type="varchar(8)"/>
            <column name="name" type="varchar(255)"/>
            <column name="ext_mark" type="varchar(50)"/>
            <column name="gfcm" type="varchar(60)"/>
            <column name="country_code" type="varchar(3)"/>
            <column name="length_overall" type="FLOAT8"/>
            <column name="main_gear_type" type="varchar(10)"/>
        </createTable>

        <rollback>
            <dropTable tableName="asset"/>
        </rollback>

        <createSequence sequenceName="area_seq" startValue="1"/>

        <createTable tableName="area">
            <column name="id" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="area_remote_id" type="varchar(64)"/>
            <column name="area_type" type="varchar(128)"/>
            <column name="area_code" type="varchar(128)"/>
            <column name="area_name" type="varchar(255)"/>
        </createTable>

        <rollback>
            <dropSequence sequenceName="area_seq"/>
            <dropTable tableName="area"/>
        </rollback>

        <createTable tableName="movement_area">
            <column name="movement_id" type="bigint"/>
            <column name="area_id" type="bigint"/>
        </createTable>

        <rollback>
            <dropTable tableName="movement_area"/>
        </rollback>

    </changeSet>

</databaseChangeLog>
